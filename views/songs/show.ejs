<%- include('../partials/header') %>

<section>
    <div>
        <img alt="avatar" src="<%= song.userAvatar %> referrerpolicy=no-referrer"> 
        <%= song.userName %>
    </div>
    <div>
        Song Title: <em><%= song.title %></em>
    </div>
    <div>
        Artist: <%= song.artist %>
    </div>
    &nbsp;
    <div>
        <%= song.caption %>
    </div>
    <br>
    <% if (user?._id.equals(song.user)) { %>
    <a href="/songs/<%= song._id %>/edit">Edit Song Post</a>  
    <% } %>
</section>
&nbsp;
<section>
<h3>Comments</h3>
</section>
<% if (user) { %>
    <form method="POST" action="/songs/<%= song._id %>/comments">
        <textarea name="content">Let 'Em Know How You Feel</textarea>
        <button type="submit">Comment</button> 
    </form>
<% } else { %>
    <p>Sign In to Comment</p>
<% } %>
    <% if (song.comments.length) { %>
        <% song.comments.forEach((commentInfo) => { %>
            <section>
            <div>
                <p>
                <img alt="avatar" src="<%= commentInfo.userAvatar %> referrerpolicy=no-referrer"> 
                <%= commentInfo.userName %>
                </p>
                <p><%= commentInfo.createdAt.toLocaleDateString() %></p>
                <p><%= commentInfo.content %></p>
                <p>
                    <% if (user?._id.equals(commentInfo.user)) { %>
                    <form action="/comments/<%= commentInfo._id %>?_method=DELETE" method="POST">
                      <button type="submit">Delete</button>
                    </form>
                    <br>
                    <a href="/comments/<%= commentInfo._id %>/edit">Edit Comment</a>
                    <% } %>
                </p>
            </div>
            </section>
        <% }) %>
    <% } else { %>
        <p>Be the First to Comment on this Post</p>
    <% } %>

<%- include('../partials/footer') %>